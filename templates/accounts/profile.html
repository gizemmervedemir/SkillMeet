{% extends 'base.html' %}
{% load widget_tweaks %}
{% load form_filters %}

{% block title %}Your Profile{% endblock %}

{% block content %}
<style>
    .dojo-badge {
        padding: 4px 12px;
        border-radius: 999px;
        font-weight: 700;
        font-size: 0.9em;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        display: inline-block;
        min-width: 90px;
        text-align: center;
    }

    .white-belt {
        background-color: #888;
    }

    .yellow-belt {
        background-color: #f1c40f;
        color: black;
    }

    .blue-belt {
        background-color: #3498db;
    }

    .red-belt {
        background-color: #e74c3c;
    }

    .master {
        background-color: gold;
        color: black;
        animation: glow 1.2s infinite alternate;
    }

    @keyframes glow {
        from {
            box-shadow: 0 0 6px rgba(255, 215, 0, 0.6);
        }

        to {
            box-shadow: 0 0 16px rgba(255, 215, 0, 1);
        }
    }

    .profile-pic {
        max-width: 150px;
        max-height: 150px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 1rem;
    }

    .section-title {
        margin-top: 2.5rem;
        margin-bottom: 1rem;
        font-weight: 600;
        border-bottom: 2px solid #dee2e6;
        padding-bottom: 0.5rem;
    }

    .btn-sm {
        min-width: 70px;
        margin-right: 0.5rem;
    }

    .partner-box {
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        background: #f8f9fa;
    }

    .venue-box {
        border: 1px dashed #999;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        background: #fffdf9;
    }

    .venue-box h5 {
        margin-top: 0;
    }

    .view-all-btn {
        margin-top: 1rem;
        display: block;
        width: 100%;
        text-align: center;
    }
</style>

{% if notifications %}
<div class="alert alert-warning shadow-sm">
    <strong>üîî You have {{ notifications.count }} new notification{{ notifications.count|pluralize }}:</strong>
    <ul class="mb-0 ps-3 mt-2">
        {% for n in notifications %}
        <li>{{ n.message }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<div class="card shadow-sm mb-4">
    <div class="card-header bg-dark text-white">
        <h5 class="mb-0">üë§ Your Profile</h5>
    </div>
    <div class="card-body bg-light profile-info">
        {% if user.profile_image and user.profile_image.url %}
        <img src="{{ user.profile_image.url }}" alt="Profile Image" class="profile-pic">
        {% else %}
        <img src="{{ MEDIA_URL }}profile_images/default_pikachu.png" alt="Default Profile" class="profile-pic">
        {% endif %}

        <p><strong>Username:</strong> {{ user.username }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>City:</strong> {{ user.city|default:"(Not specified)" }}</p>
        <p><strong>Skills to Teach:</strong> {{ user.skills_can_teach|default:"(None)" }}</p>
        <p><strong>Skills to Learn:</strong> {{ user.skills_want_to_learn|default:"(None)" }}</p>
        <p><strong>Dojo Level:</strong>
            <span class="dojo-badge {{ user.dojo_level|slugify }}">{{ user.dojo_level }}</span>
        </p>

        <form method="post" enctype="multipart/form-data" class="mt-4">
            {% csrf_token %}
            {{ form.non_field_errors }}
            {% for field in form %}
            <p>
                {{ field.label_tag }}
                {% if field|field_type == "SelectMultiple" %}
                {{ field|add_class:"form-select" }}
                <small class="form-text text-muted">Hold Ctrl (Windows) or Cmd (Mac) to select multiple.</small>
                {% elif field|field_type == "Select" %}
                {{ field|add_class:"form-select" }}
                {% elif field|field_type == "ClearableFileInput" %}
                {{ field }}
                {% else %}
                {{ field|add_class:"form-control" }}
                {% endif %}
                {{ field.errors }}
            </p>
            {% endfor %}
            <button type="submit" class="btn btn-primary w-100 mt-3">Update Profile</button>
        </form>
    </div>
</div>

{% if partner_companies %}
<h4 class="section-title">ü§ù Partner Venues</h4>
<div class="row">
    {% for partner in partner_companies %}
    <div class="col-md-6">
        <div class="partner-box">
            <h5>{{ partner.name }}</h5>
            {% if partner.website %}
            <p><a href="{{ partner.website }}" target="_blank">{{ partner.website }}</a></p>
            {% endif %}
            <p><strong>Email:</strong> {{ partner.contact_email }}</p>
            <p>{{ partner.discount_details|default:"Special offers for SkillMeet members!" }}</p>
        </div>
    </div>
    {% endfor %}
</div>
<a href="{% url 'partner_venues' %}" class="btn btn-outline-secondary view-all-btn">View All Partner Venues</a>
{% endif %}

{% if venues %}
<h4 class="section-title">üìç Suggested Venues</h4>
<div class="row">
    {% for venue in venues %}
    <div class="col-md-6">
        <div class="venue-box">
            <h5>{{ venue.name }}</h5>
            <p><strong>City:</strong> {{ venue.city }}</p>
            <p><strong>Address:</strong> {{ venue.address }}</p>
            {% if venue.contact_email %}
            <p><strong>Contact:</strong> {{ venue.contact_email }}</p>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
<a href="{% url 'all_venues' %}" class="btn btn-outline-secondary view-all-btn">View All Venues</a>
{% endif %}

{% endblock %}